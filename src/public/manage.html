<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./assets/css/manage.css" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
      crossorigin="anonymous"
    />
    <title>I'm Hungry</title>
  </head>
  <body>
    <section>
      <div class="container">
        <div class="content-wrapper">
          <div class="header-wrapper">
            <div class="list-name text-center">
              <h1 id="list-name-title">List Name</h1>
            </div>
            <div class="controls">
              <div class="input-group">
                <select class="custom-select" id="list-select">
                  <option selected>Choose List...</option>
                  <option value="1">To Explore</option>
                  <option value="2">Favorites</option>
                  <option value="3">Do Not Show</option>
                </select>
                <button type="button" class="btn btn-secondary">
                  Manage List
                </button>
                <a href="results.html">
                  <button type="button" class="btn btn-secondary">
                    Back to Results
                  </button>
                </a>
                <a href="search.html">
                  <button type="button" class="btn btn-secondary">
                    Back to Search
                  </button>
                </a>
              </div>
            </div>
          </div>
          <div id="results-list" class="reults-wrapper text-center"></div>
        </div>
      </div>
    </section>
  </body>
  <script type="text/javascript">
    let JSONObj = {};

    document.addEventListener("DOMContentLoaded", function() {
      let listName = sessionStorage.getItem("listName");
      document.getElementById("list-name-title").innerHTML = listName;
      retrieveList();
    });

    function retrieveList() {
      let xhttp = new XMLHttpRequest();
      let listNameParameter = getListNameParameter(
        sessionStorage.getItem("listName")
      );
      let parameters = "listName=" + listNameParameter;
      xhttp.open("GET", "http://localhost:8080/getList?" + parameters, true);
      xhttp.setRequestHeader("Access-Control-Allow-Origin", "*");
      xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
          if (xhttp.responseText) {
            JSONObj = JSON.parse(this.responseText);
            populateList();
          }
        }
      };
      xhttp.send();
    }

    function getListNameParameter(listName) {
      if (listName === "Favorites") {
        return "favorites";
      } else if (listName === "To Explore") {
        return "toExplore";
      } else if (listName === "Do Not Show") {
        return "doNotShow";
      } else {
        return "";
      }
    }

    function populateList() {
      // Populate list using returned results
      let listNameParameter = getListNameParameter(
        sessionStorage.getItem("listName")
      );
      for (let idx in JSONObj[listNameParameter]) {
        if (JSONObj[listNameParameter][idx]["type"] === "restaurant") {
          addRestaurantCard(idx);
        } else {
          addRecipeCard(idx);
        }
      }
    }

    function addRestaurantCard(idx) {
      let listNameParameter = getListNameParameter(
        sessionStorage.getItem("listName")
      );
      let resultsList = document.getElementById("results-list");
      let newRow = document.createElement("div");
      let listNameParameter = getListNameParameter(
        sessionStorage.getItem("listName")
      );
      newRow.className = "row";

      let newCardCol = document.createElement("div");
      newCardCol.className = "col-8";
      let newRemoveCol = document.createElement("div");
      newRemoveCol.className = "col-2 icon-container";
      newRemoveCol.innerHTML = `<i class="fas fa-times-circle fa-3x" />`;
      let newMoveCol = document.createElement("div");
      newMoveCol.className = "col-2 icon-container";
      newMoveCol.innerHTML = `<i class="fas fa-exchange-alt fa-3x" />`;

      let newCard = document.createElement("div");
      if (idx % 2 === 0) {
        newCard.className = "card text-white bg-secondary mb-3";
      } else {
        newCard.className = "card text-white bg-dark mb-3";
      }
      let newCardBody = document.createElement("div");
      newCardBody.className = "card-body";
      let newCardBodyRow = document.createElement("div");
      newCardBodyRow.className = "row";

      let restaurantNameCol = document.createElement("div");
      restaurantNameCol.className = "col-5";
      let restaurantName = document.createElement("h5");
      restaurantName.className = "card-title";
      restaurantName.innerHTML = JSONObj[listNameParameter][idx].name;
      let restaurantDrivingTime = document.createElement("h6");
      restaurantDrivingTime.innerHTML =
        JSONObj[listNameParameter][idx].drivingTime;
      restaurantNameCol.appendChild(restaurantName);
      restaurantNameCol.appendChild(restaurantDrivingTime);

      let restaurantRatingCol = document.createElement("div");
      restaurantRatingCol.className = "col-5";
      let restaurantRating = document.createElement("div");
      restaurantRating.className = "stars card-title";
      restaurantRatingValue = JSONObj[listNameParameter][idx].rating;
      restaurantRating.innerHTML =
        restaurantRatingValue + `<i class="fas fa-star" />`;
      let restaurantAddress = document.createElement("h6");
      restaurantAddress.innerHTML = JSONObj[listNameParameter][idx].address;
      restaurantRatingCol.appendChild(restaurantRating);
      restaurantRatingCol.append(restaurantAddress);

      let restaurantPriceCol = document.createElement("div");
      restaurantPriceCol.className = "col-2";
      let restaurantPriceLevel = document.createElement("h6");
      restaurantPriceLevel.className = "card-title";
      let restaurantPriceLevelValue =
        JSONObj[listNameParameter][idx].priceLevel;
      let priceString = "";
      for (let i = 0; i < restaurantPriceLevelValue; i++) {
        priceString += `<i class="fas fa-dollar-sign"></i>`;
      }
      restaurantPriceLevel.innerHTML = priceString;
      restaurantPriceCol.appendChild(restaurantPriceLevel);

      newCardBodyRow.appendChild(restaurantNameCol);
      newCardBodyRow.appendChild(restaurantRatingCol);
      newCardBodyRow.appendChild(restaurantPriceCol);
      newCardBody.appendChild(newCardBodyRow);
      newCard.appendChild(newCardBody);

      newCardCol.appendChild(newCard);
      newRow.appendChild(newCardCol);
      newRow.appendChild(newRemoveCol);
      newRow.append(newMoveCol);

      resultsList.append(newRow);
    }

    function addRecipeCard(idx) {
      let listNameParameter = getListNameParameter(
        sessionStorage.getItem("listName")
      );
      let resultsList = document.getElementById("results-list");
      let newRow = document.createElement("div");
      newRow.className = "row";

      let newCardCol = document.createElement("div");
      newCardCol.className = "col-8";
      let newRemoveCol = document.createElement("div");
      newRemoveCol.className = "col-2 icon-container";
      newRemoveCol.innerHTML = `<i class="fas fa-times-circle fa-3x" />`;
      let newMoveCol = document.createElement("div");
      newMoveCol.className = "col-2 icon-container";
      newMoveCol.innerHTML = `<i class="fas fa-exchange-alt fa-3x" />`;

      let newCard = document.createElement("div");
      if (idx % 2 === 0) {
        newCard.className = "card text-white bg-secondary mb-3";
      } else {
        newCard.className = "card text-white bg-dark mb-3";
      }
      let newCardBody = document.createElement("div");
      newCardBody.className = "card-body";
      let newCardBodyRow = document.createElement("div");
      newCardBodyRow.className = "row";

      let recipeNameCol = document.createElement("div");
      recipeNameCol.className = "col";
      let recipeName = document.createElement("h5");
      recipeName.className = "card-title";
      recipeName.innerHTML = JSONObj[listNameParameter][idx].name;
      let recipePrepTime = document.createElement("h6");
      recipePrepTime.innerHTML =
        JSONObj[listNameParameter][idx].prepTime + " mins";
      recipeNameCol.appendChild(recipeName);
      recipeNameCol.appendChild(recipePrepTime);

      let recipeRatingCol = document.createElement("div");
      recipeRatingCol.className = "col";
      let recipeRating = document.createElement("div");
      recipeRating.className = "stars card-title";
      recipeRatingValue = (JSONObj[listNameParameter][idx].rating / 100) * 5;
      recipeRating.innerHTML =
        recipeRatingValue.toFixed(2) + `<i class="fas fa-star"></i>`;
      let recipeCookTime = document.createElement("h6");
      recipeCookTime.innerHTML =
        JSONObj[listNameParameter][idx].cookTime + " mins";
      recipeRatingCol.appendChild(recipeRating);
      recipeRatingCol.append(recipeCookTime);

      newCardBodyRow.appendChild(recipeNameCol);
      newCardBodyRow.appendChild(recipeRatingCol);
      newCardBody.appendChild(newCardBodyRow);
      newCard.appendChild(newCardBody);

      newCardCol.appendChild(newCard);
      newRow.appendChild(newCardCol);
      newRow.appendChild(newRemoveCol);
      newRow.append(newMoveCol);

      resultsList.append(newRow);
    }
  </script>
  <script src="./assets/js/bootstrap.min.js" charset="utf-8"></script>
</html>
