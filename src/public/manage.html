<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./assets/css/manage.css" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
      crossorigin="anonymous"
    />
    <title>I'm Hungry</title>
  </head>
  <body>
    <section>
      <div class="container">
        <div class="content-wrapper">
          <div class="header-wrapper">
            <div class="list-name text-center">
              <h1 id="list-name-title">List Name</h1>
            </div>
            <div class="controls">
              <div class="input-group">
                <select class="custom-select" id="list-select">
                  <option selected>Choose List...</option>
                  <option value="1">To Explore</option>
                  <option value="2">Favorites</option>
                  <option value="3">Do Not Show</option>
                </select>
                <button type="button" class="btn btn-secondary">
                  Manage List
                </button>
                <a href="results.html">
                  <button type="button" class="btn btn-secondary">
                    Back to Results
                  </button>
                </a>
                <a href="search.html">
                  <button type="button" class="btn btn-secondary">
                    Back to Search
                  </button>
                </a>
              </div>
            </div>
          </div>
          <div id="results-list" class="reults-wrapper text-center"></div>
        </div>
      </div>
    </section>
  </body>
  <script type="text/javascript">
    let JSONObj = {
      results: [
        {
          uniqueId: "938450",
          name: "Churro Ice Cream Bowls",
          rating: 35,
          prepTime: 45,
          cookTime: 0,
          ingredients: [
            "2 Tbsp. brown sugar",
            "¼ cup butter, cubed",
            "caramel topping",
            "Cinnamon sugar",
            "4 eggs",
            "1 cup flour",
            "Hot fudge",
            "Ice cream",
            "Oil for frying",
            "½ tsp salt",
            "1 tsp vanilla",
            "1 cup water"
          ],
          instructions: [
            "In a medium saucepan over medium-high heat, add butter, brown sugar, salt, and water, and bring to a boil. As soon as the butter has fully melted and the mixture begins to boil, reduce the heat to medium-low and add in flour. Using a wooden spoon, stir until the dough comes together to form a ball (about 1 minute).",
            "Remove from heat and let cool for 5 minutes before proceeding to the next step (to prevent accidentally cooking the eggs).",
            "Mix in the vanilla extract and add in the eggs, one at a time, being sure to fully incorporate each egg before adding the next. Once all the eggs are incorporated, transfer it to a piping bag with a small star tip.Invert a muffin tin and spray thoroughly with nonstick cooking spray. Pipe the dough around the inverted cups in spirals to form the bowls. Immediately transfer the tray to the freezer and freeze until solid (about 3 hours or overnight).",
            "Heat oil in a deep pot to 350F (175C).",
            "Remove the muffin tin from the freezer and flex it to release the churro bowls (you may need to also use a small knife under the bottom edge to initially release them). Return any extras to the freezer while you wait to fry.Fry them in batches, until nicely browned, no more than 3 at a time. Be sure to carefully tip them into the oil so they sink to the bottom. Once desired color is reached, remove them from the oil to a paper towellined plate. Dab off any excess oil then roll them in cinnamon sugar. Fill with your favorite ice cream and toppings. Enjoy!"
          ],
          sourceURL:
            "https://www.buzzfeed.com/scottloitsch/churro-me-everywhere",
          imageURL:
            "https://spoonacular.com/recipeImages/churro-ice-cream-bowls-938450.jpg",
          type: "recipe"
        },
        {
          uniqueId: "ChIJG246_QnIwoARCsqWTxcbTaI",
          name: "Cold Stone Creamery",
          rating: 4.1,
          drivingTime: "12 mins",
          phoneNumber: "(213) 747-2744",
          address: "3730 S Figueroa St, Los Angeles, CA 90007, USA",
          website: "http://www.coldstonecreamery.com/stores/21589",
          priceLevel: 2,
          placeId: "ChIJG246_QnIwoARCsqWTxcbTaI",
          type: "restaurant"
        },
        {
          uniqueId: "ChIJRaFUkUrGwoAR01cDqj7McuQ",
          name: "Gelateria Uli",
          rating: 4.7,
          drivingTime: "19 mins",
          phoneNumber: "(213) 537-0931",
          address: "541 S Spring St #104, Los Angeles, CA 90013, USA",
          website: "http://www.gelateriauli.com/",
          priceLevel: 1,
          placeId: "ChIJRaFUkUrGwoAR01cDqj7McuQ",
          type: "restaurant"
        }
      ]
    };

    document.addEventListener("DOMContentLoaded", function() {
      let listName = sessionStorage.getItem("listName");
      document.getElementById("list-name-title").innerHTML = listName;
      // retrieveList();
      populateList();
    });

    function retrieveList() {
      let xhttp = new XMLHttpRequest();
      let listNameParameter = getListNameParameter(
        sessionStorage.getItem("listName")
      );
      let parameters = "listName=" + listNameParameter;
      xhttp.open("GET", "http://localhost:8080/getList?" + parameters, true);
      xhttp.setRequestHeader("Access-Control-Allow-Origin", "*");
      xhttp.onreadystatechange = function() {
        JSONObj = JSON.parse(this.responseText);
        populateList();
      };
      xhttp.send();
    }

    function getListNameParameter(listName) {
      if (listName === "Favorites") {
        return "favorites";
      } else if (listName === "To Explore") {
        return "toExplore";
      } else if (listName === "Do Not Show") {
        return "doNotShow";
      } else {
        return "";
      }
    }

    function populateList() {
      // Populate list using returned results
      for (let idx in JSONObj.results) {
        if (JSONObj.results[idx]["type"] === "restaurant") {
          addRestaurantCard(idx);
        } else {
          addRecipeCard(idx);
        }
      }
    }

    function addRestaurantCard(idx) {
      let resultsList = document.getElementById("results-list");
      let newRow = document.createElement("div");
      newRow.className = "row";

      let newCardCol = document.createElement("div");
      newCardCol.className = "col-8";
      let newRemoveCol = document.createElement("div");
      newRemoveCol.className = "col-2 icon-container";
      newRemoveCol.innerHTML = `<i class="fas fa-times-circle fa-3x" />`;
      let newMoveCol = document.createElement("div");
      newMoveCol.className = "col-2 icon-container";
      newMoveCol.innerHTML = `<i class="fas fa-exchange-alt fa-3x" />`;

      let newCard = document.createElement("div");
      if (idx % 2 === 0) {
        newCard.className = "card text-white bg-secondary mb-3";
      } else {
        newCard.className = "card text-white bg-dark mb-3";
      }
      let newCardBody = document.createElement("div");
      newCardBody.className = "card-body";
      let newCardBodyRow = document.createElement("div");
      newCardBodyRow.className = "row";

      let restaurantNameCol = document.createElement("div");
      restaurantNameCol.className = "col-5";
      let restaurantName = document.createElement("h5");
      restaurantName.className = "card-title";
      restaurantName.innerHTML = JSONObj.results[idx].name;
      let restaurantDrivingTime = document.createElement("h6");
      restaurantDrivingTime.innerHTML = JSONObj.results[idx].drivingTime;
      restaurantNameCol.appendChild(restaurantName);
      restaurantNameCol.appendChild(restaurantDrivingTime);

      let restaurantRatingCol = document.createElement("div");
      restaurantRatingCol.className = "col-5";
      let restaurantRating = document.createElement("div");
      restaurantRating.className = "stars card-title";
      restaurantRatingValue = JSONObj.results[idx].rating;
      restaurantRating.innerHTML =
        restaurantRatingValue + `<i class="fas fa-star" />`;
      let restaurantAddress = document.createElement("h6");
      restaurantAddress.innerHTML = JSONObj.results[idx].address;
      restaurantRatingCol.appendChild(restaurantRating);
      restaurantRatingCol.append(restaurantAddress);

      let restaurantPriceCol = document.createElement("div");
      restaurantPriceCol.className = "col-2";
      let restaurantPriceLevel = document.createElement("h6");
      restaurantPriceLevel.className = "card-title";
      let restaurantPriceLevelValue = JSONObj.results[idx].priceLevel;
      let priceString = "";
      for (let i = 0; i < restaurantPriceLevelValue; i++) {
        priceString += `<i class="fas fa-dollar-sign"></i>`;
      }
      restaurantPriceLevel.innerHTML = priceString;
      restaurantPriceCol.appendChild(restaurantPriceLevel);

      newCardBodyRow.appendChild(restaurantNameCol);
      newCardBodyRow.appendChild(restaurantRatingCol);
      newCardBodyRow.appendChild(restaurantPriceCol);
      newCardBody.appendChild(newCardBodyRow);
      newCard.appendChild(newCardBody);

      newCardCol.appendChild(newCard);
      newRow.appendChild(newCardCol);
      newRow.appendChild(newRemoveCol);
      newRow.append(newMoveCol);

      resultsList.append(newRow);
    }

    function addRecipeCard(idx) {
      let resultsList = document.getElementById("results-list");
      let newRow = document.createElement("div");
      newRow.className = "row";

      let newCardCol = document.createElement("div");
      newCardCol.className = "col-8";
      let newRemoveCol = document.createElement("div");
      newRemoveCol.className = "col-2 icon-container";
      newRemoveCol.innerHTML = `<i class="fas fa-times-circle fa-3x" />`;
      let newMoveCol = document.createElement("div");
      newMoveCol.className = "col-2 icon-container";
      newMoveCol.innerHTML = `<i class="fas fa-exchange-alt fa-3x" />`;

      let newCard = document.createElement("div");
      if (idx % 2 === 0) {
        newCard.className = "card text-white bg-secondary mb-3";
      } else {
        newCard.className = "card text-white bg-dark mb-3";
      }
      let newCardBody = document.createElement("div");
      newCardBody.className = "card-body";
      let newCardBodyRow = document.createElement("div");
      newCardBodyRow.className = "row";

      let recipeNameCol = document.createElement("div");
      recipeNameCol.className = "col";
      let recipeName = document.createElement("h5");
      recipeName.className = "card-title";
      recipeName.innerHTML = JSONObj.results[idx].name;
      let recipePrepTime = document.createElement("h6");
      recipePrepTime.innerHTML = JSONObj.results[idx].prepTime + " mins";
      recipeNameCol.appendChild(recipeName);
      recipeNameCol.appendChild(recipePrepTime);

      let recipeRatingCol = document.createElement("div");
      recipeRatingCol.className = "col";
      let recipeRating = document.createElement("div");
      recipeRating.className = "stars card-title";
      recipeRatingValue = (JSONObj.results[idx].rating / 100) * 5;
      recipeRating.innerHTML =
        recipeRatingValue.toFixed(2) + `<i class="fas fa-star"></i>`;
      let recipeCookTime = document.createElement("h6");
      recipeCookTime.innerHTML = JSONObj.results[idx].cookTime + " mins";
      recipeRatingCol.appendChild(recipeRating);
      recipeRatingCol.append(recipeCookTime);

      newCardBodyRow.appendChild(recipeNameCol);
      newCardBodyRow.appendChild(recipeRatingCol);
      newCardBody.appendChild(newCardBodyRow);
      newCard.appendChild(newCardBody);

      newCardCol.appendChild(newCard);
      newRow.appendChild(newCardCol);
      newRow.appendChild(newRemoveCol);
      newRow.append(newMoveCol);

      resultsList.append(newRow);
    }
  </script>
  <script src="./assets/js/bootstrap.min.js" charset="utf-8"></script>
</html>
